From 2a48eb99323631a8790eb8dfe199b40814ce7222 Mon Sep 17 00:00:00 2001
From: Yann Collette <ycollette.nospam@free.fr>
Date: Sun, 4 Oct 2020 14:15:41 +0200
Subject: [PATCH] fix opencv

---
 FugioApp/contextwidgetprivate.cpp   |  1 +
 plugins/OpenCV/grayscalenode.cpp    |  8 ++++----
 plugins/OpenCV/imageconvertnode.cpp | 32 ++++++++++++++---------------
 plugins/OpenCV/inpaintnode.cpp      |  2 +-
 4 files changed, 22 insertions(+), 21 deletions(-)

diff --git a/FugioApp/contextwidgetprivate.cpp b/FugioApp/contextwidgetprivate.cpp
index f4544e8..311462b 100644
--- a/FugioApp/contextwidgetprivate.cpp
+++ b/FugioApp/contextwidgetprivate.cpp
@@ -4,6 +4,7 @@
 #include <QFileDialog>
 #include <QStylePainter>
 #include <QStandardPaths>
+#include <QStyleOption>
 
 #include "app.h"
 #include "contextview.h"
diff --git a/plugins/OpenCV/grayscalenode.cpp b/plugins/OpenCV/grayscalenode.cpp
index fc11acc..7a36606 100644
--- a/plugins/OpenCV/grayscalenode.cpp
+++ b/plugins/OpenCV/grayscalenode.cpp
@@ -66,22 +66,22 @@ void GrayscaleNode::conversion( GrayscaleNode *pNode )
 			break;
 
 		case fugio::ImageFormat::BGR8:
-			cv::cvtColor( MatSrc, pNode->mMatImg, CV_BGR2GRAY );
+		  cv::cvtColor( MatSrc, pNode->mMatImg, cv::COLOR_BGR2GRAY );
 			break;
 
 		case fugio::ImageFormat::RGBA8:
-			cv::cvtColor( MatSrc, pNode->mMatImg, CV_RGBA2GRAY );
+			cv::cvtColor( MatSrc, pNode->mMatImg, cv::COLOR_RGBA2GRAY );
 			break;
 
 		case fugio::ImageFormat::BGRA8:
-			cv::cvtColor( MatSrc, pNode->mMatImg, CV_BGRA2GRAY );
+			cv::cvtColor( MatSrc, pNode->mMatImg, cv::COLOR_BGRA2GRAY );
 			break;
 
 //		case fugio::ImageFormat::GRAY16:
 //			break;
 
 //		case fugio::ImageFormat::YUYV422:
-//			cv::cvtColor( MatSrc, mMatImg, CV_YUV2GRAY_420 );
+//			cv::cvtColor( MatSrc, mMatImg, cv::COLOR_YUV2GRAY_420 );
 //			break;
 
 		default:
diff --git a/plugins/OpenCV/imageconvertnode.cpp b/plugins/OpenCV/imageconvertnode.cpp
index 6505d21..1209b77 100644
--- a/plugins/OpenCV/imageconvertnode.cpp
+++ b/plugins/OpenCV/imageconvertnode.cpp
@@ -128,11 +128,11 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::BGR8:
-					CvtCod = CV_HSV2BGR;
+					CvtCod = cv::COLOR_HSV2BGR;
 					break;
 
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_HSV2RGB;
+					CvtCod = cv::COLOR_HSV2RGB;
 					break;
 
 				default:
@@ -144,11 +144,11 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::GRAY8:
-					CvtCod = CV_RGB2GRAY;
+					CvtCod = cv::COLOR_RGB2GRAY;
 					break;
 
 				case fugio::ImageFormat::HSV8:
-					CvtCod = CV_RGB2HSV;
+					CvtCod = cv::COLOR_RGB2HSV;
 					break;
 
 				default:
@@ -160,7 +160,7 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_RGBA2RGB;
+					CvtCod = cv::COLOR_RGBA2RGB;
 					break;
 
 				default:
@@ -172,15 +172,15 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::GRAY8:
-					CvtCod = CV_BGR2GRAY;
+					CvtCod = cv::COLOR_BGR2GRAY;
 					break;
 
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_BGR2RGB;
+					CvtCod = cv::COLOR_BGR2RGB;
 					break;
 
 				case fugio::ImageFormat::HSV8:
-					CvtCod = CV_BGR2HSV;
+					CvtCod = cv::COLOR_BGR2HSV;
 					break;
 
 				default:
@@ -192,11 +192,11 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::GRAY8:
-					CvtCod = CV_BGRA2GRAY;
+					CvtCod = cv::COLOR_BGRA2GRAY;
 					break;
 
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_BGRA2RGB;
+					CvtCod = cv::COLOR_BGRA2RGB;
 					break;
 
 				default:
@@ -208,11 +208,11 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_YUV2RGB_Y422;
+					CvtCod = cv::COLOR_YUV2RGB_Y422;
 					break;
 
 				case fugio::ImageFormat::GRAY8:
-					CvtCod = CV_YUV2GRAY_Y422;
+					CvtCod = cv::COLOR_YUV2GRAY_Y422;
 					break;
 
 				default:
@@ -227,19 +227,19 @@ void ImageConvertNode::inputsUpdated( qint64 pTimeStamp )
 			switch( mDestinationFormat )
 			{
 				case fugio::ImageFormat::RGB8:
-					CvtCod = CV_GRAY2RGB;
+					CvtCod = cv::COLOR_GRAY2RGB;
 					break;
 
 				case fugio::ImageFormat::RGBA8:
-					CvtCod = CV_GRAY2RGBA;
+					CvtCod = cv::COLOR_GRAY2RGBA;
 					break;
 
 				case fugio::ImageFormat::BGR8:
-					CvtCod = CV_GRAY2BGR;
+					CvtCod = cv::COLOR_GRAY2BGR;
 					break;
 
 				case fugio::ImageFormat::BGRA8:
-					CvtCod = CV_GRAY2BGRA;
+					CvtCod = cv::COLOR_GRAY2BGRA;
 					break;
 
 				default:
diff --git a/plugins/OpenCV/inpaintnode.cpp b/plugins/OpenCV/inpaintnode.cpp
index 3ca585e..676150c 100644
--- a/plugins/OpenCV/inpaintnode.cpp
+++ b/plugins/OpenCV/inpaintnode.cpp
@@ -72,7 +72,7 @@ void InPaintNode::inputsUpdated( qint64 pTimeStamp )
 	cv::Mat		MatMsk = OpenCVPlugin::image2mat( MskImg );
 	cv::Mat		MatTmp;
 
-	cv::cvtColor( MatSrc, MatTmp, CV_BGRA2RGB );
+	cv::cvtColor( MatSrc, MatTmp, cv::COLOR_BGRA2RGB );
 
 	cv::inpaint( MatTmp, MatMsk, mMatImg, mPinInputRadius->value().toDouble(), cv::INPAINT_NS );
 
-- 
2.26.2

